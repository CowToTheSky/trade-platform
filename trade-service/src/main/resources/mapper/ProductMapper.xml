<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.trade.mapper.ProductMapper">

    <!-- 根据产品代码查询产品信息 -->
    <select id="selectByCode" parameterType="string" resultType="com.platform.trade.model.Product">
        SELECT * FROM t_product WHERE code = #{code}
    </select>

    <!-- 根据产品ID查询产品信息 -->
    <select id="selectById" parameterType="long" resultType="com.platform.trade.model.Product">
        SELECT * FROM t_product WHERE id = #{id}
    </select>

    <!-- 查询所有可交易的产品列表 -->
    <select id="selectTradableProducts" resultType="com.platform.trade.model.Product">
        SELECT * FROM t_product WHERE status = 1 
        ORDER BY code ASC
    </select>

    <!-- 根据产品类型查询产品列表 -->
    <select id="selectByType" resultType="com.platform.trade.model.Product">
        SELECT * FROM t_product WHERE type = #{type} AND status = 1 
        ORDER BY code ASC
    </select>

    <!-- 根据产品名称模糊查询 -->
    <select id="selectByNameLike" resultType="com.platform.trade.model.Product">
        SELECT * FROM t_product WHERE name LIKE CONCAT('%', #{name}, '%') 
        AND status = 1 ORDER BY code ASC
    </select>

    <!-- 查询可交易产品总数 -->
    <select id="countTradableProducts" resultType="int">
        SELECT COUNT(*) FROM t_product WHERE status = 1
    </select>

    <!-- 更新产品价格信息 -->
    <update id="updatePriceInfo">
        UPDATE t_product SET current_price = #{currentPrice}, 
        volume = #{volume}, turnover = #{turnover}, 
        change_amount = #{currentPrice} - previous_close, 
        change_percent = (#{currentPrice} - previous_close) / previous_close * 100, 
        updated_at = NOW() WHERE code = #{code}
    </update>

    <!-- 更新产品状态 -->
    <update id="updateStatus">
        UPDATE t_product SET status = #{status}, updated_at = NOW() 
        WHERE code = #{code}
    </update>

    <!-- 新增产品 -->
    <insert id="insertProduct" parameterType="com.platform.trade.model.Product">
        INSERT INTO t_product (code, name, type, current_price, previous_close, 
        open_price, high_price, low_price, volume, turnover, change_percent, 
        change_amount, market_value, circulating_shares, status, trading_unit, 
        tick_size, upper_limit, lower_limit, description, listing_date, 
        created_at, updated_at) VALUES (#{code}, #{name}, #{type}, #{currentPrice}, 
        #{previousClose}, #{openPrice}, #{highPrice}, #{lowPrice}, #{volume}, 
        #{turnover}, #{changePercent}, #{changeAmount}, #{marketValue}, 
        #{circulatingShares}, #{status}, #{tradingUnit}, #{tickSize}, 
        #{upperLimit}, #{lowerLimit}, #{description}, #{listingDate}, 
        #{createdAt}, #{updatedAt})
    </insert>

</mapper>